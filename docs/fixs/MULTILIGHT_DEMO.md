# 多光源演示程序使用指南

## 📋 概述

`MultiLightDemo` 是一个完整的多光源系统演示程序，展示了三种类型光源的实际应用效果。

## 🚀 编译和运行

### 编译
```bash
# 在项目根目录
mkdir -p build
cd build
cmake ..
make MultiLightDemo
```

### 运行
```bash
./MultiLightDemo
```

## 🎮 控制说明

### 摄像机控制
- **W/S**: 前进/后退
- **A/D**: 左移/右移
- **Q/E**: 下降/上升
- **鼠标**: 旋转视角
- **滚轮**: 调整FOV（缩放）

### 场景控制
- **1**: 切换到场景1 - 螺旋塔
- **2**: 切换到场景2 - 波浪地板
- **3**: 切换到场景3 - 浮动群岛

### 光源控制
- **L**: 切换光源标识显示/隐藏
- **SPACE**: 暂停/恢复光源动画

### 系统控制
- **TAB**: 切换鼠标捕获模式
- **ESC**: 退出程序

## 💡 光源系统

### 1. 太阳光（平行光）
- **颜色**: 暖白色 (1.0, 0.95, 0.8)
- **方向**: 从右上方照射 (-0.3, -1.0, -0.2)
- **强度**: 0.4
- **作用**: 提供全局基础照明

### 2. 彩色点光源阵列（4个）
围绕场景旋转的4个彩色点光源：

| 光源 | 颜色 (RGB) | 强度 | 有效范围 |
|------|-----------|------|----------|
| 光源 0 | 红色 (1.0, 0.2, 0.2) | 3.0 | ~32米 |
| 光源 1 | 绿色 (0.2, 1.0, 0.2) | 3.0 | ~32米 |
| 光源 2 | 蓝色 (0.2, 0.4, 1.0) | 3.0 | ~32米 |
| 光源 3 | 黄色 (1.0, 0.9, 0.2) | 3.0 | ~32米 |

**动画效果**:
- 围绕中心旋转（半径15米）
- 上下浮动（±3米）
- 光源标识脉冲缩放

### 3. 手电筒（聚光灯）
- **颜色**: 白色 (1.0, 1.0, 1.0)
- **位置**: 跟随摄像机
- **方向**: 摄像机朝向
- **强度**: 2.0
- **内锥角**: 12.5°
- **外锥角**: 17.5°（边缘柔化）
- **有效范围**: ~50米

## 🎨 视觉效果

### 光源标识
每个点光源位置都有一个小立方体标识：
- **颜色**: 与光源颜色匹配
- **大小**: 0.3倍立方体（约30cm）
- **动画**: 脉冲缩放效果（0.3-0.4倍）
- **亮度**: 2倍于光源颜色（自发光效果）

### 光照效果
- **动态阴影**: 多光源产生的复杂阴影
- **颜色混合**: 不同颜色光源叠加产生丰富的色彩效果
- **边缘柔化**: 聚光灯外锥角的平滑过渡
- **实时更新**: 所有光源每帧更新

## 🎯 场景说明

### 场景 1: 螺旋塔
- 40层螺旋形立方体塔
- 从红到黄的颜色渐变
- 从下往上逐渐变细
- 320个立方体实例

### 场景 2: 波浪地板
- 25×25网格的波浪状地板
- 海洋蓝色渐变
- 双重波浪叠加效果
- 625个立方体实例

### 场景 3: 浮动群岛
- 12个浮动的小岛
- 每个岛由100个立方体组成
- 球形分布的岛屿结构
- 彩色渐变（紫、粉、橙系）
- 1200个立方体实例

## 📊 性能指标

### 光源数量
- 平行光: 1个
- 点光源: 4个
- 聚光灯: 1个
- **总计**: 6个光源

### 渲染统计
- 场景1: 320个实例 + 4个光源标识
- 场景2: 625个实例 + 4个光源标识
- 场景3: 1200个实例 + 4个光源标识

### 预期性能
- **FPS**: 60+ (现代GPU)
- **Draw Calls**: 2次（场景 + 光源标识）
- **光照计算**: 每像素6次光源计算

## 🔧 技术细节

### 着色器特性
```glsl
// 多光源支持
#define NR_DIR_LIGHTS 4
#define NR_POINT_LIGHTS 16
#define NR_SPOT_LIGHTS 8

// 实时光照计算
vec3 CalcDirectionalLight(...);
vec3 CalcPointLight(...);
vec3 CalcSpotLight(...);
```

### 光源标识渲染
```cpp
// 使用独立的着色器渲染光源标识
lightVisualizerShader.Use();
lightVisualizerShader.SetVec3("objectColor", lightColor * 2.0f);  // 自发光效果
lightVisualizerShader.SetFloat("ambientStrength", 1.0f);          // 全亮度
```

### 动画系统
```cpp
// 点光源旋转
float angle = i * TWO_PI / 4.0f + time * rotationSpeed;
glm::vec3 pos(cos(angle) * radius, y, sin(angle) * radius);

// 上下浮动
y = 10.0f + sin(time * 2.0f + i) * 3.0f;
```

## 🎨 颜色设计

### 光源颜色选择原则
1. **高饱和度**: 颜色鲜明，便于区分
   - 红色: (1.0, 0.2, 0.2)
   - 绿色: (0.2, 1.0, 0.2)
   - 蓝色: (0.2, 0.4, 1.0)
   - 黄色: (1.0, 0.9, 0.2)

2. **强度调整**: 3.0倍强度使效果更明显
3. **标识亮度**: 2.0倍颜色值产生发光效果

### 背景颜色
- **深蓝色**: (0.02, 0.02, 0.05)
- **目的**: 突出彩色光源效果

## 📚 学习要点

### 多光源技术
1. ✅ 光源类型的选择和使用
2. ✅ 光照强度的平衡
3. ✅ 颜色混合的效果
4. ✅ 性能优化技巧

### 实践经验
1. ✅ 光源可视化调试
2. ✅ 动画系统集成
3. ✅ 用户交互设计
4. ✅ 性能监控

## 🐛 常见问题

### Q: 为什么看不到光源效果？
A: 检查以下几点：
1. 确认光源已启用（检查日志）
2. 调整光源强度（当前设置为3.0）
3. 确认材质颜色不太暗
4. 尝试按L键显示光源标识

### Q: 性能如何优化？
A: 可以尝试：
1. 减少点光源数量
2. 降低光源有效范围
3. 减少场景实例数量
4. 按L键隐藏光源标识

### Q: 如何修改光源颜色？
A: 在`SetupLighting()`函数中修改：
```cpp
glm::vec3 pointLightColors[] = {
    glm::vec3(1.0f, 0.2f, 0.2f),  // 修改这里
    // ...
};
```

## 📖 相关文档

- **多光源系统**: `docs/LIGHTING_SYSTEM.md`
- **接口文档**: `docs/interfaces/LIGHTING_INTERFACES.md`
- **实现总结**: `docs/LIGHTING_IMPLEMENTATION.md`

## ✨ 总结

MultiLightDemo 完整展示了多光源系统的功能：
- 🌞 1个平行光（太阳）
- 💡 4个彩色点光源（动态旋转）
- 🔦 1个聚光灯（手电筒）
- 🎯 光源可视化标识
- 🎨 丰富的颜色效果
- 🚀 实时动画系统

通过本演示，你可以直观地理解和学习多光源系统的使用！
