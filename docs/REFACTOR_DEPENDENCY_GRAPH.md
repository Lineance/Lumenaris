# Renderer æ–‡ä»¶ä¾èµ–å…³ç³»å›¾

## ğŸ“Š å®Œæ•´ä¾èµ–å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         åº”ç”¨å±‚                                  â”‚
â”‚                  main.cpp, test_*.cpp                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        æ¥å£å±‚                                    â”‚
â”‚           IRenderer.hpp (æŠ½è±¡æ¸²æŸ“å™¨æ¥å£)                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       æ¸²æŸ“å±‚                                     â”‚
â”‚   InstancedRenderer (å®ä¾‹åŒ–æ¸²æŸ“)                                â”‚
â”‚         â†“                                                       â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚    â†“              â†“              â†“              â†“              â”‚
â”‚  MeshBuffer    InstanceData   Shader        Texture            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       æ•°æ®å±‚                                     â”‚
â”‚   MeshData (CPUæ•°æ®) â† MeshDataFactory (åˆ›å»ºæ•°æ®)               â”‚
â”‚         â†“                                                       â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚    â†“              â†“              â†“              â†“              â”‚
â”‚   Cube         Sphere       OBJModel      OBJLoader            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”— è¯¦ç»†æ–‡ä»¶ä¾èµ–å…³ç³»

### 1. InstancedRenderer ä¾èµ–

```cpp
// InstancedRenderer.hpp
#include "Renderer/MeshBuffer.hpp"      // GPU èµ„æº
#include "Renderer/InstanceData.hpp"    // å®ä¾‹æ•°æ®
#include "Renderer/IRenderer.hpp"       // æ¥å£
#include "Renderer/Texture.hpp"         // çº¹ç†ï¼ˆå¯é€‰ï¼‰
```

**ä¾èµ–æ•°é‡**: 4 ä¸ªç›´æ¥ä¾èµ–

### 2. MeshBuffer ä¾èµ–

```cpp
// MeshBuffer.hpp
#include "Renderer/MeshData.hpp"        // CPU æ•°æ®
#include "Renderer/Texture.hpp"         // çº¹ç†
```

**ä¾èµ–æ•°é‡**: 2 ä¸ªç›´æ¥ä¾èµ–

### 3. MeshDataFactory ä¾èµ–

```cpp
// MeshDataFactory.hpp
#include "Renderer/MeshData.hpp"        // æ•°æ®å®¹å™¨
#include "Renderer/MeshBuffer.hpp"      // GPU èµ„æº
```

```cpp
// MeshDataFactory.cpp
#include "Renderer/Cube.hpp"            // ç«‹æ–¹ä½“æ•°æ®
#include "Renderer/Sphere.hpp"          // çƒä½“æ•°æ®
#include "Renderer/OBJModel.hpp"        // OBJ æ¨¡å‹
```

**ä¾èµ–æ•°é‡**: 3 ä¸ªå¤´æ–‡ä»¶ä¾èµ–ï¼Œ3 ä¸ªå®ç°ä¾èµ–

### 4. Cube ä¾èµ–

```cpp
// Cube.hpp
#include "Renderer/Mesh.hpp"            // âš ï¸ IMesh æ¥å£ï¼ˆå¯èƒ½åºŸå¼ƒï¼‰
```

**ä¾èµ–æ•°é‡**: 1 ä¸ªä¾èµ–

### 5. Sphere ä¾èµ–

```cpp
// Sphere.hpp
#include "Renderer/Mesh.hpp"            // âš ï¸ IMesh æ¥å£ï¼ˆå¯èƒ½åºŸå¼ƒï¼‰
```

**ä¾èµ–æ•°é‡**: 1 ä¸ªä¾èµ–

### 6. OBJModel ä¾èµ–

```cpp
// OBJModel.hpp
#include "Renderer/Mesh.hpp"            // âš ï¸ IMesh æ¥å£ï¼ˆå¯èƒ½åºŸå¼ƒï¼‰
#include "Renderer/OBJLoader.hpp"       // OBJ åŠ è½½å™¨
#include "Renderer/Texture.hpp"         // çº¹ç†
```

**ä¾èµ–æ•°é‡**: 3 ä¸ªä¾èµ–

### 7. OBJLoader ä¾èµ–

```cpp
// OBJLoader.hpp
#include "tiny_obj_loader.h"            // ç¬¬ä¸‰æ–¹åº“
```

**ä¾èµ–æ•°é‡**: 1 ä¸ªå¤–éƒ¨ä¾èµ–

---

## ğŸ”„ å¾ªç¯ä¾èµ–æ£€æŸ¥

### å½“å‰çŠ¶æ€: âœ… æ— å¾ªç¯ä¾èµ–

```
Cube â†’ Mesh (IMesh)
Sphere â†’ Mesh (IMesh)
OBJModel â†’ Mesh (IMesh)

å¦‚æœ Mesh.hpp è¢«åˆ é™¤ï¼Œè¿™äº›ä¾èµ–éœ€è¦ç§»é™¤ã€‚
```

---

## ğŸ“¦ æ¨¡å—åˆ†ç»„

### æ ¸å¿ƒæ¨¡å—ï¼ˆæ— ä¾èµ–ï¼‰

```
MeshData       - çº¯æ•°æ®å®¹å™¨
InstanceData   - å®ä¾‹æ•°æ®å®¹å™¨
Shader         - ç€è‰²å™¨ç®¡ç†
Texture        - çº¹ç†ç®¡ç†
OBJLoader      - æ–‡ä»¶åŠ è½½
```

### ä¸­é—´æ¨¡å—ï¼ˆå°‘é‡ä¾èµ–ï¼‰

```
MeshBuffer     â†’ MeshData, Texture
Cube           â†’ Mesh (IMesh)
Sphere         â†’ Mesh (IMesh)
MeshDataFactory â†’ Cube, Sphere, OBJModel
```

### é«˜çº§æ¨¡å—ï¼ˆå¤šä¾èµ–ï¼‰

```
InstancedRenderer â†’ MeshBuffer, InstanceData, IRenderer, Texture
OBJModel         â†’ Mesh (IMesh), OBJLoader, Texture
```

---

## ğŸ¯ é‡æ„ä¼˜å…ˆçº§

### ä¼˜å…ˆçº§ 1: ç«‹å³å¤„ç†

1. **Mesh.hpp/cpp**
   - çŠ¶æ€: å¯èƒ½åºŸå¼ƒ
   - å½±å“: Cube, Sphere, OBJModel ä¾èµ–
   - æ“ä½œ: ç¡®è®¤ååˆ é™¤æˆ–è¿ç§»

### ä¼˜å…ˆçº§ 2: å°½å¿«å¤„ç†

2. **Cube ç±»èŒè´£åˆ†ç¦»**
   - é—®é¢˜: åŒæ—¶å®ç° IMesh å’Œæä¾›é™æ€æ•°æ®
   - æ“ä½œ: åˆ†ç¦»ä¸º CubeGeometry å’Œ CubeData

### ä¼˜å…ˆçº§ 3: å¯ä»¥å»¶å

3. **Shader ç±»å¢å¼º**
   - é—®é¢˜: åŠŸèƒ½ç®€å•ï¼Œç¼ºå°‘ç¼“å­˜
   - æ“ä½œ: æ·»åŠ  uniform ä½ç½®ç¼“å­˜

---

## ğŸ“ˆ ä¾èµ–å¤æ‚åº¦åˆ†æ

### å¤æ‚åº¦è¯„åˆ†

| æ–‡ä»¶ | ç›´æ¥ä¾èµ– | é—´æ¥ä¾èµ– | å¤æ‚åº¦ |
|------|----------|----------|--------|
| InstancedRenderer | 4 | 8 | â­â­â­â­ |
| OBJModel | 3 | 5 | â­â­â­ |
| MeshDataFactory | 3 | 6 | â­â­â­ |
| MeshBuffer | 2 | 3 | â­â­ |
| Cube | 1 | 2 | â­ |
| Sphere | 1 | 2 | â­ |
| MeshData | 0 | 0 | 0 |
| InstanceData | 0 | 0 | 0 |
| Shader | 0 | 0 | 0 |
| Texture | 0 | 0 | 0 |
| OBJLoader | 1 | 1 | â­ |

---

## ğŸ” æ½œåœ¨é—®é¢˜

### é—®é¢˜ 1: Cube ç±»åŒé‡èŒè´£

```cpp
// Cube æ—¢å®ç° IMesh æ¥å£ï¼ˆæ—§ï¼‰
class Cube : public IMesh {
    void Draw() const override;
    glm::mat4 GetModelMatrix() const override;
};

// åˆæä¾›é™æ€æ•°æ®æ–¹æ³•ï¼ˆæ–°ï¼‰
static std::vector<float> GetVertexData();
static void GetVertexLayout(std::vector<size_t>&, std::vector<int>&);
```

**å½±å“**:
- æ–°æ—§æ¶æ„æ··ç”¨
- èŒè´£ä¸æ¸…æ™°

**å»ºè®®**:
- ç§»é™¤ IMesh ç»§æ‰¿
- åªä¿ç•™é™æ€æ•°æ®æ–¹æ³•
- æˆ–åˆ›å»ºç‹¬ç«‹çš„ CubeData ç±»

### é—®é¢˜ 2: Mesh.hpp çŠ¶æ€ä¸æ˜

```cpp
// Cube.hpp åŒ…å«
#include "Renderer/Mesh.hpp"

// ä½†æ–°æ¶æ„ä½¿ç”¨ MeshData è€Œä¸æ˜¯ Mesh
```

**å½±å“**:
- å¦‚æœ Mesh.hpp å·²åºŸå¼ƒï¼ŒCube/Sphere/OBJModel éœ€è¦æ›´æ–°
- å¦‚æœä»åœ¨ä½¿ç”¨ï¼Œéœ€è¦æ˜ç¡®å…¶èŒè´£

**å»ºè®®**:
- æ£€æŸ¥æ‰€æœ‰ä½¿ç”¨ Mesh.hpp çš„åœ°æ–¹
- å†³å®šä¿ç•™æˆ–åˆ é™¤

### é—®é¢˜ 3: OBJModel æ•°æ®é‡å¤

```cpp
// OBJModel åŒæ—¶åŒ…å«:
1. IMesh æ¥å£å®ç°ï¼ˆæ¸²æŸ“ï¼‰
2. GetMaterialVertexData() é™æ€æ–¹æ³•ï¼ˆæ•°æ®ç”Ÿæˆï¼‰
```

**å½±å“**:
- æ•°æ®ç”Ÿæˆé€»è¾‘å¯èƒ½é‡å¤
- èŒè´£ä¸å¤Ÿæ¸…æ™°

**å»ºè®®**:
- å°†æ•°æ®ç”Ÿæˆç§»åˆ° MeshDataFactory
- OBJModel åªè´Ÿè´£æ¸²æŸ“

---

## âœ… é‡æ„æ£€æŸ¥æ¸…å•

### ä¾èµ–å…³ç³»æ£€æŸ¥

- [ ] ç¡®è®¤ Mesh.hpp ä½¿ç”¨æƒ…å†µ
- [ ] æ£€æŸ¥æ˜¯å¦æœ‰å¾ªç¯ä¾èµ–
- [ ] éªŒè¯æ‰€æœ‰ #include è·¯å¾„æ­£ç¡®
- [ ] ç¡®è®¤å¤´æ–‡ä»¶ä¿æŠ¤å®å”¯ä¸€

### æ¨¡å—åŒ–æ£€æŸ¥

- [ ] æ¯ä¸ªæ¨¡å—èŒè´£å•ä¸€
- [ ] æ¨¡å—é—´è€¦åˆåº¦ä½
- [ ] æ¥å£æ¸…æ™°æ˜ç¡®
- [ ] æ˜“äºæ‰©å±•æ–°åŠŸèƒ½

---

## ğŸ¨ å»ºè®®çš„æ¨¡å—åˆ’åˆ†

### æ•°æ®æ¨¡å— (Data/)

```
MeshData      - CPU ç½‘æ ¼æ•°æ®
MeshBuffer    - GPU ç½‘æ ¼èµ„æº
InstanceData  - å®ä¾‹åŒ–æ•°æ®
```

### å‡ ä½•æ¨¡å— (Geometry/)

```
Cube          - ç«‹æ–¹ä½“æ•°æ®
Sphere        - çƒä½“æ•°æ®
OBJGeometry   - OBJ å‡ ä½•æ•°æ®ï¼ˆæ–°ï¼‰
```

### æ¸²æŸ“æ¨¡å— (Renderer/)

```
InstancedRenderer - å®ä¾‹åŒ–æ¸²æŸ“
ForwardRenderer   - å‰å‘æ¸²æŸ“ï¼ˆæ–°ï¼‰
DeferredRenderer  - å»¶è¿Ÿæ¸²æŸ“ï¼ˆé¢„ç•™ï¼‰
```

### èµ„æºæ¨¡å— (Resources/)

```
Shader        - ç€è‰²å™¨
Texture       - çº¹ç†
Material      - æè´¨ï¼ˆæ–°ï¼‰
```

### å·¥å‚æ¨¡å— (Factory/)

```
MeshDataFactory - ç½‘æ ¼æ•°æ®å·¥å‚
ResourceFactory  - èµ„æºå·¥å‚ï¼ˆæ–°ï¼‰
```

---

**æ–‡æ¡£åˆ›å»ºæ—¶é—´**: 2026-01-01
**åˆ†æåŸºäºç‰ˆæœ¬**: å½“å‰æ¶æ„ v2.0
